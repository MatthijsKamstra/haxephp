<?php

// Generated by Haxe 3.4.4
class Main {
	public function __construct() { if(!php_Boot::$skip_constructor) {
		$this->getUrl("https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&date=" . _hx_string_or_null($this->getCurrentDate()), false);
	}}
	public function getUrl($url, $isPost = null) {
		if($isPost === null) {
			$isPost = false;
		}
		$_gthis = $this;
		$req = new haxe_Http($url);
		$req->onData = array(new _hx_lambda(array(&$_gthis), "Main_0"), 'execute');
		$req->onError = array(new _hx_lambda(array(), "Main_1"), 'execute');
		$req->onStatus = array(new _hx_lambda(array(), "Main_2"), 'execute');
		$req->request($isPost);
	}
	public function showImage($data) {
		php_Lib::hprint("<img src=\"" . _hx_string_or_null($data->hdurl) . "\" alt=\"" . _hx_string_or_null($data->title) . "\">");
	}
	public function getCurrentDate() {
		$date = Date::now();
		$year = $date->getFullYear();
		$month = $date->getMonth() + 1;
		$day = $date->getDate();
		$s = Std::string($month);
		$tmp = null;
		$tmp1 = null;
		if(strlen("0") !== 0) {
			$tmp1 = strlen($s) >= 2;
		} else {
			$tmp1 = true;
		}
		if($tmp1) {
			$tmp = $s;
		} else {
			$tmp = str_pad($s, Math::ceil((2 - strlen($s)) / strlen("0")) * strlen("0") + strlen($s), "0", STR_PAD_LEFT);
		}
		$s1 = Std::string($day);
		$tmp2 = null;
		$tmp3 = null;
		if(strlen("0") !== 0) {
			$tmp3 = strlen($s1) >= 2;
		} else {
			$tmp3 = true;
		}
		if($tmp3) {
			$tmp2 = $s1;
		} else {
			$tmp2 = str_pad($s1, Math::ceil((2 - strlen($s1)) / strlen("0")) * strlen("0") + strlen($s1), "0", STR_PAD_LEFT);
		}
		return _hx_string_rec($year, "") . "-" . _hx_string_or_null($tmp) . "-" . _hx_string_or_null($tmp2);
	}
	static function main() {
		$main = new Main();
	}
	function __toString() { return 'Main'; }
}
function Main_0(&$_gthis, $data) {
	{
		try {
			$json = haxe_Json::phpJsonDecode($data);
			$_gthis->showImage($json);
		}catch(Exception $__hx__e) {
			$_ex_ = ($__hx__e instanceof HException) && $__hx__e->getCode() == null ? $__hx__e->e : $__hx__e;
			$e = $_ex_;
			{
				haxe_Log::trace($e, _hx_anonymous(array("fileName" => "Main.hx", "lineNumber" => 33, "className" => "Main", "methodName" => "getUrl")));
			}
		}
	}
}
function Main_1($error) {
	{
		haxe_Log::trace("error: " . _hx_string_or_null($error), _hx_anonymous(array("fileName" => "Main.hx", "lineNumber" => 39, "className" => "Main", "methodName" => "getUrl")));
	}
}
function Main_2($status) {
	{}
}
